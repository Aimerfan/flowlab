{% extends 'base.html' %}
{% load static %}
{% block title %}
    測試報告
{% endblock %}
{% block body %}
    {% include 'cicd_nav.html' with project=info.name %}
    <div class="container_close">
        <div class="content">
            {% if not_built %}
                <h2 class="text-center">該分支正在建置中，請稍後再重整頁面</h2>
            {% endif %}

            {% if sonar_info %}
                <div class="row">
                    <div class="col-sm-3"></div>
                    <div class="col-sm-6">
                        <h1>SonarQube Test Report</h1>
                        <p>Show only the latest results.</p>
                    </div>
                    <div class="col-sm-3">
                        <div class="right_content">
                            <h5><a href="{{ sonar_url }}" target="_blank">View Detailed Report</a></h5>
                        </div>
                    </div>
                    <table class="table table-bordered table-warning table-striped">
                        <thead>
                            <tr>
                                <th>Bugs</th>
                                <th>Vulnerabilities</th>
                                <th>Security Hotspots</th>
                                <th>Code Smells</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>{{ sonar_info.bugs }}</td>
                                <td>{{ sonar_info.vulnerabilities }}</td>
                                <td>{{ sonar_info.security_hotspots }}</td>
                                <td>{{ sonar_info.code_smells }}</td>
                            </tr>
                        </tbody>
                    </table>
                {% endif %}
                <div style="padding: 15px;">
                    <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownBranch" data-bs-toggle="dropdown" aria-expanded="false">
                        <span style="width: 100px;">{{ branch }}</span>
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownBranch">
                        {% for branch in info.branches %}
                            <li><a class="dropdown-item" href="{% url 'test_reports' user.username info.name branch.name %}">{{ branch.name }}</a></li>
                        {% endfor %}
                    </ul>
                </div>
                {% if junit_info %}
                    <h1>Junit Test Result</h1>
                    <table class="table table-bordered table-success table-striped">
                        <thead>
                            <tr>
                                <th>Failure</th>
                                <th>Skip</th>
                                <th>Pass</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>{{ junit_info.fail }}</td>
                                <td>{{ junit_info.skip }}</td>
                                <td>{{ junit_info.success }}</td>
                                <td>{{ junit_info.total}}</td>
                            </tr>
                        </tbody>
                    </table>
                {% endif %}
                {% if coverage_info %}
                    <h1>Coverage Test Report</h1>
                    <table class="table table-bordered table-primary table-striped">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>instruction</th>
                                <th>branch</th>
                                <th>complexity</th>
                                <th>line</th>
                                <th>method</th>
                                <th>class</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th>All Categories</th>
                                <td>{% include 'test/coverage_chart.html' with data=coverage_info.instruction %}</td>
                                <td>{% include 'test/coverage_chart.html' with data=coverage_info.branch %}</td>
                                <td>{% include 'test/coverage_chart.html' with data=coverage_info.complexity %}</td>
                                <td>{% include 'test/coverage_chart.html' with data=coverage_info.line %}</td>
                                <td>{% include 'test/coverage_chart.html' with data=coverage_info.method %}</td>
                                <td>{% include 'test/coverage_chart.html' with data=coverage_info.class %}</td>
                            </tr>
                        </tbody>

                    </table>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}