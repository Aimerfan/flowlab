{% extends 'base.html' %}
{% load static %}
{% block title %}
    Jenkins File
{% endblock %}
{% block body %}
<script src="{% static 'js/jquery-3.6.0.min.js' %}"></script>
<script src="{% static 'js/jquery.cookie-1.4.1.min.js' %}"></script>
{% include 'cicd_nav.html' with project=info.name %}
    <div class="container container_close">
        <div class="align_both_sides">
            <div class="col-md-5">
                <button type="button" class="btn btn-info" style="float: right;" id="switch_mode" value="simpleMode">切換模式</button>
                <div id="simpleMode" style="display: none;">
                    <h5>Simple Setting</h5>
                    <form id="config_form" method="post" action="">
                        {% csrf_token %}
                        <div style="background: aliceblue; padding: 5px;">
                            <h6>專案類型：</h6>
                            <div class="d-flex justify-content-evenly">
                                {% for value, label in form.type.items %}
                                    <input class="btn-check" type="radio" name="type" value="{{ value }}" id="{{ value }}" autocomplete="off" required>
                                    <label class="btn btn-outline-success" for="{{ value }}">{{ label }}</label>
                                {% endfor %}
                            </div>
                            <h6>需要檢測的項目：</h6>
                            <div class="ms-3">
                                {% for value, label in form.test.items %}
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" role="switch" name="test" value="{{ value }}" id="{{ value }}" checked>
                                    <label class="form-check-label" for="{{ value }}">{{ label }}</label>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        <button id="submit_config" class="btn btn-primary">確認修改</button>
                    </form>
                </div>
                <div id="puzzleMode">
                    <h5>Jenkins File Puzzle</h5>
                    <form method="post" action="" name="pipeline" id="pipe_form">
                        {% csrf_token %}
                        <div class="pipeline jenkins_puzzle">
                            pipeline
                            <div id="agent" class="puz_bl_2">
                                <div class="jenkins_puzzle puz_add puz_2" id="addAgent" onclick="newAgent()">
                                    + agent
                                    <img src="{% static 'core/images/question-mark.png' %}" alt="" style="width: 20px;">
                                </div>
                            </div>
                            <div id="stages" class="puz_bl_2">
                                <div class="jenkins_puzzle puz_add puz_2" id="addStages" onclick="newStages()">
                                    + stages
                                    <img src="{% static 'core/images/question-mark.png' %}" alt="" style="width: 20px;">
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-primary btn_pipe">確認修改</button>
                    </form>
                </div>
            </div>
            <div class="col-md-6">
                <div class="align_both_sides">
                    <h5>Jenkinsfile</h5>
                    <button id="btn_download" class="btn btn-secondary">Download</button>
                </div>
                <div class="jenkins_code_content">
                    <pre><code style="font-size: 16px;" class="info"></code></pre>
                </div>
            </div>
        </div>
    </div>
<script src="{% static 'ci/js/new_puzzle.js' %}"></script>
<script src="{% static 'ci/js/jenkins_file.js' %}"></script>
<script>
    {# 切換 Jenkinsfile 的模式 #}
    $('#switch_mode').click(function (){
        let mode = $(this);
        if(mode.val() === 'simpleMode') {
            $('#simpleMode').css('display', 'block');
            $('#puzzleMode').css('display', 'none');
            mode.val('puzzleMode');
        }
        else if(mode.val() === 'puzzleMode'){
            $('#simpleMode').css('display', 'none');
            $('#puzzleMode').css('display', 'block');
            mode.val('simpleMode');
        }
    });
</script>
{% endblock %}